<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2018"><meta name="DC.rights.owner" content="(C) Copyright 2018"><meta name="DC.Type" content="concept"><meta name="DC.Relation" scheme="URI" content="../topics/impala_langref_sql.html"><meta name="prodname" content="Impala"><meta name="prodname" content="Impala"><meta name="version" content="Impala 3.0.x"><meta name="version" content="Impala 3.0.x"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="refresh"><link rel="stylesheet" type="text/css" href="../commonltr.css"><title>REFRESH Statement</title></head><body id="refresh"><main role="main"><article role="article" aria-labelledby="ariaid-title1">

  <h1 class="title topictitle1" id="ariaid-title1">REFRESH Statement</h1>



  <div class="body conbody">

    <p class="p">

      To accurately respond to queries, the Impala node that acts as the coordinator (the node to which you are
      connected through <span class="keyword cmdname">impala-shell</span>, JDBC, or ODBC) must have current metadata about those
      databases and tables that are referenced in Impala queries. If you are not familiar with the way Impala uses
      metadata and how it shares the same metastore database as Hive, see
      <a class="xref" href="impala_hadoop.html#intro_metastore">Overview of Impala Metadata and the Metastore</a> for background information.
    </p>

    <p class="p">
        <strong class="ph b">Syntax:</strong>
      </p>

<pre class="pre codeblock"><code>REFRESH [<var class="keyword varname">db_name</var>.]<var class="keyword varname">table_name</var> [PARTITION (<var class="keyword varname">key_col1</var>=<var class="keyword varname">val1</var> [, <var class="keyword varname">key_col2</var>=<var class="keyword varname">val2</var>...])]
<span class="ph">REFRESH FUNCTIONS <var class="keyword varname">db_name</var></span>
</code></pre>

    <p class="p">
        <strong class="ph b">Usage notes:</strong>
      </p>

    <p class="p">
      Use the <code class="ph codeph">REFRESH</code> statement to load the latest metastore metadata and block location data for
      a particular table in these scenarios:
    </p>

    <ul class="ul">
      <li class="li">
        After loading new data files into the HDFS data directory for the table. (Once you have set up an ETL
        pipeline to bring data into Impala on a regular basis, this is typically the most frequent reason why
        metadata needs to be refreshed.)
      </li>

      <li class="li">
        After issuing <code class="ph codeph">ALTER TABLE</code>, <code class="ph codeph">INSERT</code>, <code class="ph codeph">LOAD DATA</code>, or other
        table-modifying SQL statement in Hive.
      </li>
    </ul>

    <div class="note note note_note"><span class="note__title notetitle">Note:</span>
      <p class="p">
        In <span class="keyword">Impala 2.3</span> and higher, the syntax <code class="ph codeph">ALTER TABLE <var class="keyword varname">table_name</var> RECOVER PARTITIONS</code>
        is a faster alternative to <code class="ph codeph">REFRESH</code> when the only change to the table data is the addition of
        new partition directories through Hive or manual HDFS operations.
        See <a class="xref" href="impala_alter_table.html#alter_table">ALTER TABLE Statement</a> for details.
      </p>
    </div>

    <p class="p">
      You only need to issue the <code class="ph codeph">REFRESH</code> statement on the node to which you connect to issue
      queries. The coordinator node divides the work among all the Impala nodes in a cluster, and sends read
      requests for the correct HDFS blocks without relying on the metadata on the other nodes.
    </p>

    <p class="p">
      <code class="ph codeph">REFRESH</code> reloads the metadata for the table from the metastore database, and does an
      incremental reload of the low-level block location data to account for any new data files added to the HDFS
      data directory for the table. It is a low-overhead, single-table operation, specifically tuned for the common
      scenario where new data files are added to HDFS.
    </p>

    <p class="p">
      Only the metadata for the specified table is flushed. The table must already exist and be known to Impala,
      either because the <code class="ph codeph">CREATE TABLE</code> statement was run in Impala rather than Hive, or because a
      previous <code class="ph codeph">INVALIDATE METADATA</code> statement caused Impala to reload its entire metadata catalog.
    </p>

    <div class="note note note_note"><span class="note__title notetitle">Note:</span>
      <p class="p">
        The catalog service broadcasts any changed metadata as a result of Impala
        <code class="ph codeph">ALTER TABLE</code>, <code class="ph codeph">INSERT</code> and <code class="ph codeph">LOAD DATA</code> statements to all
        Impala nodes. Thus, the <code class="ph codeph">REFRESH</code> statement is only required if you load data through Hive
        or by manipulating data files in HDFS directly. See <a class="xref" href="impala_components.html#intro_catalogd">The Impala Catalog Service</a> for
        more information on the catalog service.
      </p>
      <p class="p">
        Another way to avoid inconsistency across nodes is to enable the
        <code class="ph codeph">SYNC_DDL</code> query option before performing a DDL statement or an <code class="ph codeph">INSERT</code> or
        <code class="ph codeph">LOAD DATA</code>.
      </p>
      <p class="p">
        The table name is a required parameter. To flush the metadata for all tables, use the
        <code class="ph codeph"><a class="xref" href="impala_invalidate_metadata.html#invalidate_metadata">INVALIDATE METADATA</a></code>
        command.
      </p>
      <p class="p">
      Because <code class="ph codeph">REFRESH <var class="keyword varname">table_name</var></code> only works for tables that the current
      Impala node is already aware of, when you create a new table in the Hive shell, enter
      <code class="ph codeph">INVALIDATE METADATA <var class="keyword varname">new_table</var></code> before you can see the new table in
      <span class="keyword cmdname">impala-shell</span>. Once the table is known by Impala, you can issue <code class="ph codeph">REFRESH
      <var class="keyword varname">table_name</var></code> after you add data files for that table.
    </p>
    </div>

    <p class="p">
      <code class="ph codeph">INVALIDATE METADATA</code> and <code class="ph codeph">REFRESH</code> are counterparts: <code class="ph codeph">INVALIDATE
      METADATA</code> waits to reload the metadata when needed for a subsequent query, but reloads all the
      metadata for the table, which can be an expensive operation, especially for large tables with many
      partitions. <code class="ph codeph">REFRESH</code> reloads the metadata immediately, but only loads the block location
      data for newly added data files, making it a less expensive operation overall. If data was altered in some
      more extensive way, such as being reorganized by the HDFS balancer, use <code class="ph codeph">INVALIDATE
      METADATA</code> to avoid a performance penalty from reduced local reads. If you used Impala version 1.0,
      the <code class="ph codeph">INVALIDATE METADATA</code> statement works just like the Impala 1.0 <code class="ph codeph">REFRESH</code>
      statement did, while the Impala 1.1 <code class="ph codeph">REFRESH</code> is optimized for the common use case of adding
      new data files to an existing table, thus the table name argument is now required.
    </p>

    <p class="p">
      A metadata update for an <code class="ph codeph">impalad</code> instance <strong class="ph b">is</strong> required if:
    </p>

    <ul class="ul">
      <li class="li">
        A metadata change occurs.
      </li>

      <li class="li">
        <strong class="ph b">and</strong> the change is made through Hive.
      </li>

      <li class="li">
        <strong class="ph b">and</strong> the change is made to a metastore database to which clients such as the Impala shell or ODBC directly
        connect.
      </li>
    </ul>

    <p class="p">
      A metadata update for an Impala node is <strong class="ph b">not</strong> required after you run <code class="ph codeph">ALTER TABLE</code>,
      <code class="ph codeph">INSERT</code>, or other table-modifying statement in Impala rather than Hive. Impala handles the
      metadata synchronization automatically through the catalog service.
    </p>

    <p class="p">
      Database and table metadata is typically modified by:
    </p>

    <ul class="ul">
      <li class="li">
        Hive - through <code class="ph codeph">ALTER</code>, <code class="ph codeph">CREATE</code>, <code class="ph codeph">DROP</code> or
        <code class="ph codeph">INSERT</code> operations.
      </li>

      <li class="li">
        Impalad - through <code class="ph codeph">CREATE TABLE</code>, <code class="ph codeph">ALTER TABLE</code>, and <code class="ph codeph">INSERT</code>
        operations. <span class="ph">Such changes are propagated to all Impala nodes by the
        Impala catalog service.</span>
      </li>
    </ul>

    <p class="p">
      <code class="ph codeph">REFRESH</code> causes the metadata for that table to be immediately reloaded. For a huge table,
      that process could take a noticeable amount of time; but doing the refresh up front avoids an unpredictable
      delay later, for example if the next reference to the table is during a benchmark test.
    </p>

    <p class="p">
      <strong class="ph b">Refreshing a single partition:</strong>
    </p>

    <p class="p">
      In <span class="keyword">Impala 2.7</span> and higher, the <code class="ph codeph">REFRESH</code> statement can apply to a single partition at a time,
      rather than the whole table. Include the optional <code class="ph codeph">PARTITION (<var class="keyword varname">partition_spec</var>)</code>
      clause and specify values for each of the partition key columns.
    </p>

    <p class="p">
      The following examples show how to make Impala aware of data added to a single partition, after data is loaded into
      a partition's data directory using some mechanism outside Impala, such as Hive or Spark. The partition can be one that
      Impala created and is already aware of, or a new partition created through Hive.
    </p>

<pre class="pre codeblock"><code>
impala&gt; create table p (x int) partitioned by (y int);
impala&gt; insert into p (x,y) values (1,2), (2,2), (2,1);
impala&gt; show partitions p;
+-------+-------+--------+------+...
| y     | #Rows | #Files | Size |...
+-------+-------+--------+------+...
| 1     | -1    | 1      | 2B   |...
| 2     | -1    | 1      | 4B   |...
| Total | -1    | 2      | 6B   |...
+-------+-------+--------+------+...

-- ... Data is inserted into one of the partitions by some external mechanism ...
beeline&gt; insert into p partition (y = 1) values(1000);

impala&gt; refresh p partition (y=1);
impala&gt; select x from p where y=1;
+------+
| x    |
+------+
| 2    | &lt;- Original data created by Impala
| 1000 | &lt;- Additional data inserted through Beeline
+------+

</code></pre>

    <p class="p">
      The same applies for tables with more than one partition key column.
      The <code class="ph codeph">PARTITION</code> clause of the <code class="ph codeph">REFRESH</code>
      statement must include all the partition key columns.
    </p>

<pre class="pre codeblock"><code>
impala&gt; create table p2 (x int) partitioned by (y int, z int);
impala&gt; insert into p2 (x,y,z) values (0,0,0), (1,2,3), (2,2,3);
impala&gt; show partitions p2;
+-------+---+-------+--------+------+...
| y     | z | #Rows | #Files | Size |...
+-------+---+-------+--------+------+...
| 0     | 0 | -1    | 1      | 2B   |...
| 2     | 3 | -1    | 1      | 4B   |...
| Total |   | -1    | 2      | 6B   |...
+-------+---+-------+--------+------+...

-- ... Data is inserted into one of the partitions by some external mechanism ...
beeline&gt; insert into p2 partition (y = 2, z = 3) values(1000);

impala&gt; refresh p2 partition (y=2, z=3);
impala&gt; select x from p where y=2 and z = 3;
+------+
| x    |
+------+
| 1    | &lt;- Original data created by Impala
| 2    | &lt;- Original data created by Impala
| 1000 | &lt;- Additional data inserted through Beeline
+------+

</code></pre>

    <p class="p">
      The following examples show how specifying a nonexistent partition does not cause any error,
      and the order of the partition key columns does not have to match the column order in the table.
      The partition spec must include all the partition key columns; specifying an incomplete set of
      columns does cause an error.
    </p>

<pre class="pre codeblock"><code>
-- Partition doesn't exist.
refresh p2 partition (y=0, z=3);
refresh p2 partition (y=0, z=-1)
-- Key columns specified in a different order than the table definition.
refresh p2 partition (z=1, y=0)
-- Incomplete partition spec causes an error.
refresh p2 partition (y=0)
ERROR: AnalysisException: Items in partition spec must exactly match the partition columns in the table definition: default.p2 (1 vs 2)

</code></pre>

    <p class="p">
        If you connect to different Impala nodes within an <span class="keyword cmdname">impala-shell</span> session for
        load-balancing purposes, you can enable the <code class="ph codeph">SYNC_DDL</code> query option to make each DDL
        statement wait before returning, until the new or changed metadata has been received by all the Impala
        nodes. See <a class="xref" href="../shared/../topics/impala_sync_ddl.html#sync_ddl">SYNC_DDL Query Option</a> for details.
      </p>

    <p class="p">
        <strong class="ph b">Examples:</strong>
      </p>

    <p class="p">
      The following example shows how you might use the <code class="ph codeph">REFRESH</code> statement after manually adding
      new HDFS data files to the Impala data directory for a table:
    </p>

<pre class="pre codeblock"><code>[impalad-host:21000] &gt; refresh t1;
[impalad-host:21000] &gt; refresh t2;
[impalad-host:21000] &gt; select * from t1;
...
[impalad-host:21000] &gt; select * from t2;
... </code></pre>

    <p class="p">
      For more examples of using <code class="ph codeph">REFRESH</code> and <code class="ph codeph">INVALIDATE METADATA</code> with a
      combination of Impala and Hive operations, see <a class="xref" href="impala_tutorial.html#tutorial_impala_hive">Switching Back and Forth Between Impala and Hive</a>.
    </p>

    <p class="p">
      <strong class="ph b">Related impala-shell options:</strong>
    </p>

    <p class="p">
      The <span class="keyword cmdname">impala-shell</span> option <code class="ph codeph">-r</code> issues an <code class="ph codeph">INVALIDATE METADATA</code> statement
      when starting up the shell, effectively performing a <code class="ph codeph">REFRESH</code> of all tables.
      Due to the expense of reloading the metadata for all tables, the <span class="keyword cmdname">impala-shell</span> <code class="ph codeph">-r</code>
      option is not recommended for day-to-day use in a production environment. (This option was mainly intended as a workaround
      for synchronization issues in very old Impala versions.)
    </p>

    <p class="p">
        <strong class="ph b">HDFS permissions:</strong>
      </p>
    <p class="p">
      The user ID that the <span class="keyword cmdname">impalad</span> daemon runs under,
      typically the <code class="ph codeph">impala</code> user, must have execute
      permissions for all the relevant directories holding table data.
      (A table could have data spread across multiple directories,
      or in unexpected paths, if it uses partitioning or
      specifies a <code class="ph codeph">LOCATION</code> attribute for
      individual partitions or the entire table.)
      Issues with permissions might not cause an immediate error for this statement,
      but subsequent statements such as <code class="ph codeph">SELECT</code>
      or <code class="ph codeph">SHOW TABLE STATS</code> could fail.
    </p>
    <p class="p">
      All HDFS and Sentry permissions and privileges are the same whether you refresh the entire table
      or a single partition.
    </p>

    <p class="p">
        <strong class="ph b">HDFS considerations:</strong>
      </p>

    <p class="p">
      The <code class="ph codeph">REFRESH</code> command checks HDFS permissions of the underlying data files and directories,
      caching this information so that a statement can be cancelled immediately if for example the
      <code class="ph codeph">impala</code> user does not have permission to write to the data directory for the table. Impala
      reports any lack of write permissions as an <code class="ph codeph">INFO</code> message in the log file, in case that
      represents an oversight. If you change HDFS permissions to make data readable or writeable by the Impala
      user, issue another <code class="ph codeph">REFRESH</code> to make Impala aware of the change.
    </p>

    <div class="note important note_important"><span class="note__title importanttitle">Important:</span>
        After adding or replacing data in a table used in performance-critical queries, issue a <code class="ph codeph">COMPUTE
        STATS</code> statement to make sure all statistics are up-to-date. Consider updating statistics for a
        table after any <code class="ph codeph">INSERT</code>, <code class="ph codeph">LOAD DATA</code>, or <code class="ph codeph">CREATE TABLE AS
        SELECT</code> statement in Impala, or after loading data through Hive and doing a <code class="ph codeph">REFRESH
        <var class="keyword varname">table_name</var></code> in Impala. This technique is especially important for tables that
        are very large, used in join queries, or both.
      </div>

    <p class="p">
        <strong class="ph b">Amazon S3 considerations:</strong>
      </p>
    <p class="p">
        The <code class="ph codeph">REFRESH</code> and <code class="ph codeph">INVALIDATE METADATA</code> statements also cache metadata
        for tables where the data resides in the Amazon Simple Storage Service (S3).
        In particular, issue a <code class="ph codeph">REFRESH</code> for a table after adding or removing files
        in the associated S3 data directory.
        See <a class="xref" href="../shared/../topics/impala_s3.html#s3">Using Impala with the Amazon S3 Filesystem</a> for details about working with S3 tables.
      </p>

    <p class="p">
        <strong class="ph b">Cancellation:</strong> Cannot be cancelled.
      </p>

    <p class="p">
        <strong class="ph b">Kudu considerations:</strong>
      </p>
    <p class="p">
        Much of the metadata for Kudu tables is handled by the underlying
        storage layer. Kudu tables have less reliance on the metastore
        database, and require less metadata caching on the Impala side.
        For example, information about partitions in Kudu tables is managed
        by Kudu, and Impala does not cache any block locality metadata
        for Kudu tables.
      </p>
    <p class="p">
        The <code class="ph codeph">REFRESH</code> and <code class="ph codeph">INVALIDATE METADATA</code>
        statements are needed less frequently for Kudu tables than for
        HDFS-backed tables. Neither statement is needed when data is
        added to, removed, or updated in a Kudu table, even if the changes
        are made directly to Kudu through a client program using the Kudu API.
        Run <code class="ph codeph">REFRESH <var class="keyword varname">table_name</var></code> or
        <code class="ph codeph">INVALIDATE METADATA <var class="keyword varname">table_name</var></code>
        for a Kudu table only after making a change to the Kudu table schema,
        such as adding or dropping a column, by a mechanism other than
        Impala.
      </p>

    <p class="p">
        <strong class="ph b">UDF considerations:</strong>
      </p>
    <div class="p">
        In <span class="keyword">Impala 2.9</span> and higher, you can refresh the user-defined functions (UDFs)
        that Impala recognizes, at the database level, by running the <code class="ph codeph">REFRESH FUNCTIONS</code>
        statement with the database name as an argument. Java-based UDFs can be added to the metastore
        database through Hive <code class="ph codeph">CREATE FUNCTION</code> statements, and made visible to Impala
        by subsequently running <code class="ph codeph">REFRESH FUNCTIONS</code>. For example:

<pre class="pre codeblock"><code>CREATE DATABASE shared_udfs;
USE shared_udfs;
...use CREATE FUNCTION statements in Hive to create some Java-based UDFs
   that Impala is not initially aware of...
REFRESH FUNCTIONS shared_udfs;
SELECT udf_created_by_hive(c1) FROM ...
</code></pre>
      </div>

    <p class="p">
        <strong class="ph b">Related information:</strong>
      </p>
    <p class="p">
      <a class="xref" href="impala_hadoop.html#intro_metastore">Overview of Impala Metadata and the Metastore</a>,
      <a class="xref" href="impala_invalidate_metadata.html#invalidate_metadata">INVALIDATE METADATA Statement</a>
    </p>
  </div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../topics/impala_langref_sql.html">Impala SQL Statements</a></div></div></nav></article></main></body></html>
